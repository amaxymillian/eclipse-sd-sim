<!doctype html>
<title>Eclipse Second Dawn - Battle Simulator</title>


<head>
  <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='style.css') }}">
  <script src="../static/scripts/tracking-min.js"></script>
  <style>
  /* Appropriated from: https://www.w3schools.com/css/css_dropdowns.asp 
  ... this seems to only work internally */
  /* Style The Dropdown Button */
  .dropbtn {
    background-color: #377ba8;
    color: white;
    padding: 16px;
    font-size: 16px;
    border: none;
    cursor: pointer;
  }

  /* The container <div> - needed to position the dropdown content */
  .dropdown {
    position: relative;
    display: inline-block;
  }

  /* Dropdown Content (Hidden by Default) */
  .dropdown-content {
    display: none;
    position: absolute;
    background-color: #f9f9f9;
    min-width: 160px;
    box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
    z-index: 1;
  }

  /* Links inside the dropdown */
  .dropdown-content a {
    color: black;
    padding: 12px 16px;
    text-decoration: none;
    display: block;
  }

  /* Change color of dropdown links on hover */
  .dropdown-content a:hover {background-color: #f1f1f1}

  /* Show the dropdown menu on hover */
  .dropdown:hover .dropdown-content {
    display: block;
  }

  /* Change the background color of the dropdown button when the dropdown content is shown */
  .dropdown:hover .dropbtn {
    background-color: #3e8e41;
  }

  </style>
  
  <script>
  function addBlueprint(blueprintName) {
    img = document.getElementById("blueprintImg")
    if(img == null) {
      img = document.createElement("img");
      img.setAttribute("id", "blueprintImg")
      document.getElementById("shipBlueprintDiv").appendChild(img);
    }

    switch(blueprintName) {
      case 'Terran_Interceptor':
        img.src = "/static/images/blueprints/Terran_Interceptor.png";
        break;
      case 'Terran_Cruiser':
        img.src = "/static/images/blueprints/Terran_Cruiser.png";
        break;
      case 'Terran_Dreadnought':
        img.src = "/static/images/blueprints/Terran_Dreadnought.png";
        break;
      case 'Terran_Starbase':
        img.src = "/static/images/blueprints/Terran_Starbase.png";
        break;
      default:
        console.log(`Error, unrecognized blueprintName ${blueprintName}!`);
        break;

    }
    
    //document.body.appendChild(img);
    
  }

  function showShipDesigner() {
    //alert("clicked!");
    shipDesigner = document.getElementById("shipDesigner");
    //shipDesigner.removeAttribute("hidden");
    shipDesigner.style.display = "block";
  }

  function addPartToShip(partName) {
    //Create a highlightable area of the canvas and write the name of the part as a hidden tag
    var shipBlueprintCanvas = document.getElementById('shipBlueprintCanvas');
    var width = shipBlueprintCanvas.width;
    var height = shipBlueprintCanvas.height;

    var context = shipBlueprintCanvas.getContext('2d');

    // Load image as new each time?
    const image = new Image();
    image.src = '/static/images/parts/' + partName + '.png'; 

    context.drawImage(image, 0, 0, width, height);

    //Create banding boxes for all squares (target locations for part) on this ship
    //TODO: check to see if part fitting would be allowed - this would require python calls to our py code
    // or building javascript functions that can calculate power requirements / drive requirements/ etc.
    tracking.Fast.THRESHOLD = 50;
    context.drawImage(image, 0, 0, width, height);

        var imageData = context.getImageData(0, 0, width, height);
        var gray = tracking.Image.grayscale(imageData.data, width, height);
        var corners = tracking.Fast.findCorners(gray, width, height);

        for (var i = 0; i < corners.length; i += 2) {
          context.fillStyle = '#f00';
          context.fillRect(corners[i], corners[i + 1], 3, 3);
        }    



  }

  </script>
</head>
<!--
<nav>
  <h1>Flaskr</h1>
  <ul>

  </ul>
</nav>
-->
<section class="content">
  <header>
    <h1>Eclipse SD Sim</h1>>
  </header>
  
  <table>
    <tr>
      <div class="dropdown">
        <button class="dropbtn">Ship Designer</button>
        <div class="dropdown-content">
          <a href="#" onclick="showShipDesigner()">New...</a>
          <a href="#">Open Saved Ship</a>
          <a href="#">Save Current Ship </a>
        </div>
      </div>
    </tr>
    <tr>
      <div class="dropdown">
        <button class="dropbtn">Battle Simulator</button>
        <div class="dropdown-content">
          <a href="#">New...</a>
          <a href="#">Open Saved Battle</a>
          <a href="#">Save Current Battle </a>
        </div>
      </div>
    </tr>
  </table>
  
  <div id="shipDesigner" style="display:none;">
    <div class="dropdown">
      <button class="dropbtn">Select Blueprint</button>
      <div class="dropdown-content">
        <a href="#" onclick="addBlueprint('Terran_Interceptor')">Terran Interceptor</a>
        <a href="#" onclick="addBlueprint('Terran_Cruiser')">Terran Cruiser</a>
        <a href="#" onclick="addBlueprint('Terran_Dreadnought')">Terran Dreadnought </a>
        <a href="#" onclick="addBlueprint('Terran_Starbase')">Terran Starbase </a>
      </div>
    </div>
    <table>
      <tr>
        <div id="shipBlueprintDiv">
          <canvas id="shipBlueprintCanvas" width="500" height="300"></canvas>
        </div>
      </tr>
      <tr>
        <td>
          <div class="dropdown">
            <button class="dropbtn">Cannons</button>
            <div class="dropdown-content">
              <table>
                <tr>
                  <td><img src="/static/images/parts/Ion_Cannon.png" onclick="addPartToShip('Ion_Cannon')"></td>
                  <td><img src="/static/images/parts/Plasma_Cannon.png"></td>
                </tr>
                <tr>
                  <td><img src="/static/images/parts/Soliton_Cannon.png"></td>
                  <td><img src="/static/images/parts/Antimatter_Cannon.png"></td>
                </tr>
              </table>
            </div>
          </div>
        </td>
        <td>
          <div class="dropdown">
            <button class="dropbtn">Computers</button>
            <div class="dropdown-content">
              <table>
                <tr>
                  <td><img src="/static/images/parts/Electron_Computer.png"></td>
                  <td><img src="/static/images/parts/Positron_Computer.png"></td>
                </tr>
                <tr>
                  <td><img src="/static/images/parts/Gluon_Computer.png"></td>
                </tr>
              </table>
            </div>
          </div>
        </td>
      </tr>
    </table>
    </div>

  </div>

  <!--
  <form method="post" action="/index">

    
    <input type="submit" value="run_sim" name="Run Simulation!" />


  </form>

  <input type="submit" value="add_ship" name="Add Ship" onclick="addImage()"/>
  -->
  {% for message in get_flashed_messages() %}
    <div class="flash">{{ message }}</div>
  {% endfor %}
  {% block content %}{% endblock %}
</section>